<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>

<script type="text/javascript">

  var map;
  var latlng;
  var myOptions
  var marker;

  function iniMap() {
    var lat = <%= @site.latitud %>;
    var lng = <%= @site.longitud %>;
    latlng = new google.maps.LatLng(lat,lng);
    myOptions = {
      zoom: <%= @site.zoom %>,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    }
    map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
    marker = new google.maps.Marker({
            map: map,
            position: latlng
        });
  }

</script>

<div id="site" >
 
  <h1><%= @site.type.name if @site.type %></h1> 

  <%= image_tag(@site.image_url, :class => 'site_image') %>

  <h3><%= @site.name %></h3> 

  <p><%=sanitize @site.description %></p>

  <p><b>Autor:</b> 
          <%= @site.user.name if @site.user %></p>

  <div class="visitas">
    <p><b>Visitas:</b>  <%= @site.visitas %></p>
  </div>

  <p>
    Incluido en <%=@site.visits.length%> viaje<%if @site.visits.length != 1%>s<%end%>
  </p>

  <div id="map_canvas" style="width: 450px; height: 300px;"></div>
  
  <p>
    <% if @site.comments != [] %>
      <b>Todos los comentarios:</b>
        <%= render @site.comments %>
    <% end %>
  </p>

<!-- Muestra el formulario para dejar un nuevo
comentario sólo si hay un usuario loggeado -->
  <p>
    <% if current_user != nil %>
      <b>Añada su comentario:</b>
      <%= render "comments/form" %>
    <% else %>
      <%= link_to "Inicie sesión", new_user_session_path %> 
      para dejar un comentario.
    <% end %>
  </p>

</div> 

<p />
<% if current_user != nil %>
  <% if (@site.user == current_user) or (current_user.name == 'admin') %>
    <%= link_to 'Edit', edit_site_path(@site) %> |
  <% end %>
<% end %>
<%= link_to 'Back', sites_path %>